local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local vim = game:GetService("VirtualInputManager")

local LP = Players.LocalPlayer
local Shared = getgenv().SchmecktHubPC or {}
getgenv().SchmecktHubPC = Shared

local key = "AutoReload"
Shared.Connections = Shared.Connections or {}
if Shared.Connections[key] then 
    for _, c in pairs(Shared.Connections[key]) do pcall(function() c:Disconnect() end) end
end
Shared.Connections[key] = {}

local lastReload = 0

table.insert(Shared.Connections[key], RunService.Heartbeat:Connect(function()
    if not Shared.AutoReload then return end
    
    local char = LP.Character
    if not char then return end
    
    local tool = char:FindFirstChildOfClass("Tool")
    
    if tool then
        local ammoObj = tool:FindFirstChild("AMMO") or tool:FindFirstChild("Ammo")
        
        if ammoObj and tonumber(ammoObj.Value) == 0 and (tick() - lastReload) > 2 then
            lastReload = tick()
            task.spawn(function()
                vim:SendKeyEvent(true, Enum.KeyCode.R, false, game)
                task.wait(0.1)
                vim:SendKeyEvent(false, Enum.KeyCode.R, false, game)
            end)
        end
    end
end))
